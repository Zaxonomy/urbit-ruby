require "urbit/ship"

describe Urbit::Channel do
  let(:ship) { Urbit::Ship.new }
  let!(:channel) { ship.open_channel('Test Channel') }

  it "is initialized with a name" do
    expect(channel.name).to_not be_nil
    expect(channel.name).to eq('Test Channel')
  end

  it "has an autogenerated key" do
    expect(channel.key).to_not be_nil
  end

  it "has a key 16 chars long" do
    expect(channel.key.size).to eq(16)
  end

  it "can send a message once opened" do
    expect(channel.sent_messages.size).to eq(1)
    expect(channel.open?)
  end

  it "can be closed" do
    expect(channel.sent_messages.size).to eq(1)
    expect(channel.close).to eq("ok")
    expect(channel.sent_messages.size).to eq(2)
    expect(channel.closed?)
  end
end
